<?php

function calculateBMI($height, $weight)
{
    $height = explode('-', $height);
    $heightInches = (int)$height[0] * 12 + (int)$height[1];
    $BMI = (int)$weight / ($heightInches * $heightInches) * 703;
        return $BMI;
}

if ($argv[1] != "")
        $leadid = $argv[1];
else
        $leadid = $_POST["leadid"];



$pingPost = new PingPostCommon();
$lmsData = $pingPost->fetchLead($leadid, 'lifeins_lead');
if (empty($lmsData)) {
    echo "Result=NotSold - Empty result found for lead id: " . $leadid;
    exit;
}

$postStringVals = json_decode($lmsData['poststring'], true);
$vals = array_merge($lmsData,$postStringVals, $_POST);
extract($vals);


$stringCoverage = '53920, 53930, 53953, 53952, 53965, 53901, 53940, 53936, 53949, 53913, 53964, 53944, 53954, 53910, 53926, 53969, 53947, 53939,
				   53955, 53961, 54930, 53561, 54960, 53951, 53934, 53960, 53959, 53958, 54968, 53555, 53923, 53948, 53935, 53927, 53928, 53943,
				   53946, 54982, 53578, 53941, 54613, 53911, 53583, 53957, 54943, 53956, 53571, 53950, 54941, 53529, 53968, 53942, 53532, 54646,
				   53932, 53933, 54970, 53962, 53929, 53598, 53931, 54966, 53597, 53560, 54923, 53937, 54637, 53925, 54984, 53577, 53924, 54618,
				   53596, 54971, 54634, 53718, 53590, 53919, 53528, 53783, 54976, 53515, 53916, 53562, 54457, 54965, 54921, 53704, 54638, 54934,
				   53963, 53777, 53503, 53793, 53794, 53791, 53708, 54909, 53588, 53705, 53717, 53714, 53778, 53779, 53707, 53792, 54967, 53703,
				   53789, 53706, 53559, 53786, 54649, 53774, 53726, 53785, 53702, 53788, 53790, 53701, 53715, 54980, 53922, 53557, 53725, 53716,
				   53579, 53782, 54974, 54964, 53584, 54494, 53719, 53784, 53711, 53594, 53713, 54963, 53581, 53527, 53556, 54469, 54932, 54641,
				   53744, 54413, 54670, 54660, 53540, 53593, 53039, 53517, 54902, 53558, 53572, 53507, 53032, 53016, 54651, 53531, 54495, 54986,
				   54946, 53506, 54467, 54940, 53065, 54981, 54406, 54639, 53582, 54904, 54979, 54662, 53006, 53050, 54983, 53575, 54927, 53551,
				   53034, 54903, 53098, 54648, 54666, 54492, 54475, 54937, 53047, 53094, 54906, 54947, 53589, 53544, 54901, 53035, 53523, 53508,
			       54458, 54969, 54936, 54489, 53048, 54977, 54935, 53091, 53595, 53099, 54664, 53533, 53573, 53521, 54407, 54481, 54985, 53038,
				   53059, 54466, 54931, 54619, 53543, 54990, 54945, 53518, 54482, 53535, 54962, 53574, 53549, 54423, 54652, 53019, 54949, 53049,
				   53137, 53003, 54961, 54410, 53002, 53036, 53078, 54443, 54643, 53526, 54655, 54956, 54656, 54944, 54667, 54454, 53553, 54957,
				   53538, 53010, 53516, 53565, 53570, 54473, 53534, 54415, 53536, 54942, 54665, 53569, 53027, 53057, 53502, 54952, 54412, 54653,
				   53178, 53805, 53088, 54620, 53066, 54912, 54914, 54926, 53069, 54913, 53086, 53040, 54449, 53079, 54441, 54420, 54631, 54915, 
				   53504, 54919, 53554, 53563, 53064, 54911, 54170, 54922, 54614, 53058, 54623, 54621, 53580, 53090, 53014, 53809, 54657, 54645,
				   54472, 54136, 54404, 53537, 54169, 53018, 53095, 53599, 53029, 53033, 53190, 53056, 54436, 53076, 53118, 54113, 53825, 53547,
				   53530, 53545, 54628, 54140, 53026, 53520, 53023, 53017, 54615, 54950, 54654, 53062, 53037, 54455, 53156, 53826, 54929, 53548,
				   54432, 53576, 53061, 53566, 54129, 53542, 54669, 54130, 54429, 54642, 53546, 54644, 53510, 53183, 54486, 53827, 53089, 53011,
				   53153, 54106, 54456, 53522, 53020, 54440, 53587, 53127, 53060, 53072, 53022, 54427, 54160, 54123, 53119, 54131, 54933, 53505,
				   54484, 53021, 53073, 53501, 53541, 54626, 54640, 53046, 54928, 53818, 54499, 54754, 53042, 53188, 53816, 53001, 53012, 54479,
				   53052, 54152, 53093, 53075, 53813, 54658, 54948, 54110, 54978, 54180, 54601, 53511, 53189, 53550, 53051, 54650, 53031, 53187,
				   54602, 54632, 54471, 54624, 53186, 53080, 54476, 54611, 54207, 53045, 53586, 54603, 54165, 61060, 53149, 54446, 54232, 54426,
				   53120, 54474, 53224, 61089, 52151, 54416, 53008, 55919, 54636, 53005, 52146, 53007, 53097, 54448, 61087, 53525, 53024, 52160,
				   53512, 54635, 54746, 53004, 53225, 53013, 54414, 53146, 53074, 61019, 53122, 54403, 61050, 54401, 53121, 54245, 54128, 53817,
				   53114, 54488, 54659, 61059, 55947, 61024, 54126, 53223, 53092, 53085, 53804, 54230, 53222, 53803, 53263, 61001, 54344, 61079,
				   53103, 55941, 53115, 54107, 53226, 61070, 53218, 53070, 54166, 52170, 61018, 53807, 53820, 53151, 53044, 61080, 61072, 54437,
				   53808, 53821, 53082, 54115, 53083, 54627, 53216, 53213, 54155, 53063, 53209, 53227, 53214, 53210, 61013, 54402, 53015, 54421,
				   53801, 61048, 61075, 53217, 53138, 53150, 54616, 55925, 54417, 53228, 53081, 54493, 53802, 53208, 54630, 54741, 53585, 53812,
				   61073, 53130, 53295, 53811, 52157, 53206, 54304, 53219, 53185, 54305, 54307, 52158, 53191, 53810, 53176, 54182, 55931, 53220,
				   53205, 54405, 53234, 54450, 54408, 54324, 54313, 61027, 54301, 54162, 53233, 53212, 53184, 53824, 54303, 53125, 54215, 53293,
				   53167, 54247, 54111, 53211, 53288, 53148, 53201, 54661, 53267, 53268, 53203, 54760, 53259, 53129, 53290, 53215, 53237, 53274,
				   53204, 53806, 53202, 53147, 54411, 53278, 54306, 54150, 55921, 61067, 61044, 61032, 54422, 53105, 53132, 54227, 61115, 52001,
				   61063, 54220, 61011, 53221, 54302, 54135, 54208, 54464, 52073, 61085, 61132, 61131, 61036, 54425, 53207, 54773, 61065, 61012,
			 	   54311, 52140, 61111, 61025, 53195, 54214, 54308, 61130, 54460, 61101, 52004, 53235, 54137, 61103, 54127, 52099, 52066, 55943,
				   52172, 61088, 61114, 61062, 54498, 54173, 53139, 54141, 53110, 52049, 61028, 54171, 60033, 53157, 60001, 52002, 53154, 61077,
				   52156, 52159, 52047, 54758, 54409, 61105, 53172, 61107, 52052, 52003, 61106, 61110, 54480, 53108, 53159, 52039, 61102, 61039,
				   54747, 54625, 54221, 54612, 54452, 61104, 54722, 53128, 53152, 53126, 54124, 55974, 54228, 53182, 52053, 61108, 61126, 54241,
				   60034, 61007, 55942, 52071, 61125, 54229, 53101, 61041, 53181, 61112, 61008, 54430, 54771, 53168, 61047, 54240, 52072, 53170,
				   52054, 54101, 52048, 52056, 61016, 53192, 60071, 61109, 52068, 55987, 54154, 54770, 61078, 53402, 53109, 52044, 52031, 53177,
				   61038, 54424, 52043, 54451, 55971, 53194, 60097, 61030, 53179, 54418, 52065, 52162, 53406, 61010, 54174, 52035, 60072, 61046,
				   54768, 52045, 54629, 60081, 53404, 52133, 60098';


$coverage = explode(',', $stringCoverage);

if(!(in_array($zip, $coverage)))
{
        echo "Zip code didn't match";
        exit;
}


$BMI = calculateBMI($height, $weight);

$message = 'The following person has inquired about a life insurance policy.  Please contact this person.  Do not respond to the email address from which this email was sent.
'."\n"."\n";


$message .= "First Name: " . $name . "\n";
$message .= "Last Name: " . $lastname . "\n";
$message .= "Address: " . $address . "\n";
$message .= "City: " . $city . "\=n";
$message .= "State: " . $st . "\n";
$message .= "Zip Code: " . $zip . "\n";
$message .= "Email Address: " . $emailaddress . "\n";
$message .= "Phone number: " . $homephone . "\n";
$message .= "Date of Birth: " . $dob_month . "-".$dob_day."-".$dob_year."\n";
$message .= "Height: " . $height . "\n";
$message .= "Weight: " . $weight . "\n";
$message .= "Tobacco Usage: " . $tobacco . "\n";
$message .= "Term Length: " . $termlength . "\n";
$message .= "Coverage Amount: " . $coverageamount . "\n";
$message .= "BMI: " . substr((string)$BMI, 0, 5) . "\n";

//REAL LEADS GO HERE
$to = 'jacobxs@ruralins.com';

$headers = "From: leads@undergroundelephant.com" . "\r\n";

if(@mail($to, 'Lead from Underground Elephant', $message, $headers)){
        echo 'Success';
}else{
        echo 'Failure';
}
?>